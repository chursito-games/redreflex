<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YL7TDWMHZ0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-YL7TDWMHZ0');
  </script>

  <title>Red Reflex — Reaction Time Test (Best of 5)</title>
  
  <link rel="canonical" href="https://redreflex.net/" />
  <meta name="description" content="Red Reflex is a fast reaction time test (Best of 5). Wait for the screen to turn red, then tap as quickly as you can. Track your personal best on your device." />
  <meta property="og:title" content="Red Reflex — Reaction Time Test (Best of 5)" />
  <meta property="og:description" content="Wait for red. Tap instantly. Play 5 rounds and beat your personal best." />
  <meta property="og:url" content="https://redreflex.net/" />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#0b0f1a" />
<meta name="description" content="Red Reflex is a free reaction time test. Press Start, wait for the screen to turn red, then tap as fast as you can. Play 5 rounds, track your best time, and challenge friends." />

  <style>

    :root{
      --bg:#0b0f1a;
      --panel:#0f1730;
      --panel2:#0c1328;
      --text:#e9eefc;
      --muted:#a9b4d6;
      --accent:#6ee7ff;
      --accent2:#a78bfa;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --red:#ff2b2b;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1000px 600px at 20% 0%, rgba(110,231,255,.10), transparent 55%),
                  radial-gradient(900px 500px at 100% 20%, rgba(167,139,250,.12), transparent 60%),
                  radial-gradient(900px 600px at 50% 120%, rgba(34,197,94,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      overflow:auto;
      overscroll-behavior: none;
      min-height: 100svh;
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* When in game mode on mobile, avoid scroll friction */
    body.game-mode{
      overflow:hidden;
      touch-action: manipulation;
    }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:18px;
      align-content:start;
      gap:12px;
    }

    .card{
      width:min(980px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:0;
    }

    @media (max-width: 860px){
      .card{ grid-template-columns: 1fr; }
    }

    .left{
      padding:18px 18px 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border-right: 1px solid rgba(255,255,255,.08);
    }
    @media (max-width: 860px){
      .left{ border-right:none; border-bottom: 1px solid rgba(255,255,255,.08); }
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:14px;
    }
    .logo{
      width:40px;height:40px;border-radius:12px;
      background:
        radial-gradient(circle at 30% 30%, rgba(110,231,255,.9), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(167,139,250,.9), transparent 55%),
        rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 30px rgba(110,231,255,.12);
    }
    .title{ line-height:1.1; }
    .title h1,
    .title h2{
      margin:0;
      font-size:18px;
      letter-spacing:.4px;
    }
    .title p{
      margin:4px 0 0;
      font-size:12px;
      color:var(--muted);
    }

    .statgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin:14px 0;
    }
    .stat{
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding:10px 10px 9px;
    }
    .stat .k{
      display:block;
      font-size:11px;
      color:var(--muted);
      letter-spacing:.2px;
    }
    .stat .v{
      display:block;
      margin-top:4px;
      font-size:16px;
      font-weight:700;
    }

    .controls{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:10px;
    }
    button{
      appearance:none;
      border:none;
      border-radius: 14px;
      padding:10px 12px;
      font-weight:700;
      color:var(--text);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      cursor:pointer;
      transition: transform .06s ease, background .12s ease, border-color .12s ease;
    }
    button:hover{ background: rgba(255,255,255,.11); }
    button:active{ transform: translateY(1px); }

    .primary{
      background: linear-gradient(90deg, rgba(110,231,255,.18), rgba(167,139,250,.18));
      border-color: rgba(110,231,255,.22);
    }
    .danger{
      background: rgba(239,68,68,.13);
      border-color: rgba(239,68,68,.22);
    }
    .ghost{ background: rgba(0,0,0,.18); }

    .foot{
      margin-top:10px;
      font-size:11px;
      color:rgba(255,255,255,.45);
    }

    .right{
      position:relative;
      min-height: 420px;
    }

    .playfield{
      position:absolute; inset:0;
      display:grid;
      place-items:center;
      padding:18px;
      cursor:pointer;
      background: linear-gradient(180deg, rgba(0,0,0,.14), rgba(0,0,0,.25));
      touch-action: manipulation;
      -webkit-user-select: none;
    }

    .center{
      width:min(520px, 100%);
      text-align:center;
      padding:20px 18px;
      border-radius: var(--radius);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
    }

    .big{
      font-size:22px;
      margin:0 0 8px;
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      font-size:13px;
      color:var(--muted);
      line-height:1.45;
    }

    .pillrow{
      display:flex;
      gap:8px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .pill{
      font-size:12px;
      padding:8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color:var(--muted);
    }
    .pill strong{ color:var(--text); }

    .phase-ready .playfield{ cursor:default; }
    .phase-wait .playfield{ cursor:pointer; }
    .phase-go .playfield{ cursor:pointer; }

    .go-surface{
      position:absolute; inset:0;
      background: radial-gradient(900px 600px at 50% 20%, rgba(255,43,43,.18), rgba(255,43,43,.88));
      opacity:0;
      transition: opacity 120ms ease;
      pointer-events:none;
    }
    .phase-go .go-surface{ opacity:1; }

    @keyframes shake {
      0%,100%{ transform:translateX(0); }
      20%{ transform:translateX(-6px); }
      40%{ transform:translateX(6px); }
      60%{ transform:translateX(-4px); }
      80%{ transform:translateX(4px); }
    }
    .shake{ animation: shake .22s ease; }

    .toast{
      position:absolute;
      left:50%;
      bottom:16px;
      transform:translateX(-50%);
      background: rgba(0,0,0,.60);
      border: 1px solid rgba(255,255,255,.12);
      color:var(--text);
      padding:10px 12px;
      border-radius: 999px;
      font-size:12px;
      opacity:0;
      transition: opacity 150ms ease, transform 150ms ease;
      pointer-events:none;
      backdrop-filter: blur(8px);
      box-shadow: 0 16px 30px rgba(0,0,0,.35);
      max-width: calc(100% - 24px);
      text-align:center;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-2px);
    }

    .pageTitle{
      width:min(980px, 100%);
      margin:0 auto 12px;
      text-align:center;
    }
    .pageTitle h1{
      margin:0;
      font-size:34px;
      letter-spacing:.6px;
      line-height:1.05;
      text-shadow: 0 10px 30px rgba(110,231,255,.12);
    }
    .pageTitle p{
      margin:8px 0 0;
      color:var(--muted);
      font-size:14px;
    }

    .howto{
      width:min(980px, 100%);
      margin:0 auto 14px;
      padding:14px 16px;
      border-radius: var(--radius);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 16px 40px rgba(0,0,0,.20);
    }
    .howto h2{
      margin:0 0 8px;
      font-size:16px;
      letter-spacing:.2px;
    }
    .howto ol{
      margin:0;
      padding-left:18px;
      color:var(--muted);
      font-size:14px;
      line-height:1.5;
    }
    .howto b{ color:var(--text); }

    .roundV{
      font-size:22px !important;
      letter-spacing:.5px;
    }

    .nextBig{
      width:100%;
      padding:14px 14px;
      font-size:14px;
      letter-spacing:.6px;
      background: linear-gradient(90deg, rgba(34,197,94,.18), rgba(110,231,255,.16));
      border: 1px solid rgba(34,197,94,.30);
    }
    .nextBig:disabled{
      opacity:.55;
      cursor:not-allowed;
    }

    .cta{
      margin:10px 0 0;
      font-size:13px;
      color: rgba(233,238,252,.92);
    }

    /* Mobile tuning */
    @media (max-width: 560px){
      .wrap{
        padding:12px;
        place-items:stretch;
      }

      .pageTitle h1{ font-size:28px; }
      .pageTitle p{ font-size:13px; }

      .howto{ padding:12px 14px; }
      .howto ol{ font-size:13px; }

      .card{ width: 100%; }

      .left{ padding:14px; }

      .statgrid{ grid-template-columns: 1fr; }

      .roundV{ font-size:18px !important; }

      button{
        padding:14px 14px;
        font-size:15px;
        border-radius: 16px;
      }

      .nextBig{
        padding:18px 16px;
        font-size:16px;
      }

      .right{
        min-height: 52svh;
      }

      .center{ padding:16px 14px; }

      .big{ font-size:20px; }

      .pill{
        font-size:11px;
        padding:7px 9px;
      }
    }

    /* =========
       GAME MODE (Option A)
       On mobile during a run: hide title/howto, compact left, expand playfield.
       ========= */
    @media (max-width: 560px){
      body.game-mode .pageTitle,
      body.game-mode .howto{
        display:none !important;
      }

      body.game-mode .wrap{
        padding:10px;
        gap:10px;
      }

      body.game-mode .card{
        height: 100svh;
      }

      /* Compact the left panel to the essentials */
      body.game-mode .left{
        padding:10px 12px;
      }
      body.game-mode .brand{
        display:none; /* frees vertical space */
      }

      /* Show only ROUND + PB while playing */
      body.game-mode .statgrid{
        margin:0 0 10px;
        gap:8px;
      }
      body.game-mode .statgrid .stat:nth-child(3),
      body.game-mode .statgrid .stat:nth-child(4){
        display:none;
      }

      body.game-mode .controls{
        margin-top:0;
        gap:10px;
      }

      /* Hide non-essential buttons while in-run to reduce clutter */
      body.game-mode #copyBtn,
      body.game-mode #resetBtn{
        display:none;
      }

      body.game-mode .foot{
        display:none;
      }

      /* Expand the game area */
      body.game-mode .right{
        min-height: 68svh;
      }

      /* Slightly larger center for clarity */
      body.game-mode .center{
        width: min(560px, 100%);
      }
    }

  
    /* Footer nav (AdSense-friendly site navigation) */
    footer.site-footer{
      width:min(980px, 100%);
      margin: 12px auto 22px;
      padding: 12px 14px;
      border-radius: var(--radius);
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 12px;
      line-height: 1.5;
    }
    footer.site-footer a{
      color: var(--text);
      text-decoration: underline;
    }
    footer.site-footer .row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    footer.site-footer .links{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
    }
    
  </style>
</head>

<body>
  <div class="wrap">

    <div class="pageTitle" id="pageTitle">
      <h1>Red Reflex</h1>
      <p>Reaction Time Test — Best of 5</p>
    </div>

    <div class="howto" id="howto">
      <h2>How to play</h2>
      <ol>
        <li>Press <b>Start</b>.</li>
        <li>Wait… at a random moment (8–15s) the screen turns <b>red</b>.</li>
        <li><b>Click / tap immediately</b> when it turns red.</li>
        <li>Early clicks count as <b>Too soon</b> (penalty).</li>
        <li>Play <b>5 rounds</b>. Beat your personal best and share your score.</li>
      </ol>
    </div>

    
    <section class="howto" id="aboutSnippet" aria-label="About Red Reflex">
      <h2>About this test</h2>
      <div style="color:var(--muted); font-size:14px; line-height:1.55;">
        <p style="margin:0 0 10px;">
          <b>Red Reflex</b> is a lightweight <b>reaction time test</b> you can play in under a minute. It’s designed to measure how quickly you respond to a clear visual cue: the screen flashes <b>red</b>, and your job is to tap immediately.
        </p>
        <p style="margin:0 0 10px;">
          Each run is <b>Best of 5</b>. After every round you’ll see your result in milliseconds, plus your average for the current run. Early taps count as “Too soon” so the game stays honest and you can’t “pre-click” your way to a fast time.
        </p>
        <p style="margin:0 0 10px;">
          Your <b>Personal Best</b> is stored locally on your device (in your browser) so you can track improvement over time. It’s not tied to an account, and we don’t ask for logins, emails, or payments—just play, practice, and compare scores with friends.
        </p>
        <p style="margin:0;">
          Want more details about how it works and what data is collected? Read the <a href="/about.html" style="color:inherit; text-decoration:underline;">About</a> page, or check the <a href="/privacy.html" style="color:inherit; text-decoration:underline;">Privacy Policy</a>.
        </p>
      </div>
    </section>
<div class="card phase-ready" id="app">
      <div class="left">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div class="title">
            <h2>Red Reflex</h2>
            <p>Reaction time • Best of 5 • Local personal best</p>
          </div>
        </div>

        <div class="statgrid" aria-label="Stats">
          <div class="stat">
            <span class="k">ROUND</span>
            <span class="v roundV" id="roundText">ROUND 0 / 5</span>
          </div>
          <div class="stat">
            <span class="k">Personal Best</span>
            <span class="v" id="bestText">—</span>
          </div>
          <div class="stat">
            <span class="k">Last Result</span>
            <span class="v" id="lastText">—</span>
          </div>
          <div class="stat">
            <span class="k">Average (this run)</span>
            <span class="v" id="avgText">—</span>
          </div>
        </div>

        <div class="controls">
          <button class="primary" id="startBtn" type="button">Start (Best of 5)</button>
          <button class="nextBig" id="nextBtn" type="button" disabled>CLICK HERE FOR NEXT ROUND</button>
          <button class="ghost" id="copyBtn" type="button" disabled>Copy result</button>
          <button class="danger" id="resetBtn" type="button">Reset PB</button>
        </div>
        <div class="foot">Tip: Mobile usually feels faster with a single finger tap.</div>
      </div>

      <div class="right">
        <div class="go-surface" aria-hidden="true"></div>

        <div class="playfield" id="playfield" role="button" aria-label="Game area" tabindex="0">
          <div class="center" id="centerCard">
            <p class="big" id="headline">Press Start</p>
            <p class="sub" id="subline">
              You will play 5 rounds. Your best time is saved on this device.
            </p>
            <p class="cta" id="ctaLine" hidden>Try to beat yourself and share to beat your friends!</p>
            <div class="pillrow">
              <div class="pill"><strong>Random wait:</strong> 8–15s</div>
              <div class="pill"><strong>Measure:</strong> ms (3 decimals)</div>
              <div class="pill"><strong>Rule:</strong> early click = penalty</div>
            </div>
          </div>
        </div>

        <div class="toast" id="toast" aria-live="polite"></div>
      </div>
    </div>
    <footer class="site-footer" role="contentinfo">
      <div class="row">
        <div>© 2026 Red Reflex</div>
        <div class="links">
          <a href="/about.html">About</a>
          <a href="/privacy.html">Privacy Policy</a>
          <a href="mailto:churdomains@gmail.com">Contact: churdomains@gmail.com</a>
        </div>
      </div>
    </footer>

  </div>

  <script defer>
    (() => {
      "use strict";

      // -------------------------
      // Configuration
      // -------------------------
      const TOTAL_ROUNDS = 5;
      const WAIT_MIN_MS = 8000;
      const WAIT_MAX_MS = 15000;
      const DECIMALS = 3;

      const SAVE_KEY = "red_reflex_v1";

      function track(eventName, params = {}) {
  if (typeof window.gtag === "function") {
    window.gtag("event", eventName, params);
  }
}
      // -------------------------
      // DOM
      // -------------------------
      const app = document.getElementById("app");
      const playfield = document.getElementById("playfield");
      const centerCard = document.getElementById("centerCard");

      const startBtn = document.getElementById("startBtn");
      const nextBtn = document.getElementById("nextBtn");
      const copyBtn = document.getElementById("copyBtn");
      const resetBtn = document.getElementById("resetBtn");

      const headline = document.getElementById("headline");
      const subline = document.getElementById("subline");
      const ctaLine = document.getElementById("ctaLine");

      const roundText = document.getElementById("roundText");
      const bestText = document.getElementById("bestText");
      const lastText = document.getElementById("lastText");
      const avgText = document.getElementById("avgText");

      const toast = document.getElementById("toast");

      // -------------------------
      // State
      // -------------------------
      const defaultState = () => ({
        phase: "ready", // ready | wait | go | result | done
        round: 0,
        waitTimerId: null,
        goTime: 0,
        lastMs: null,
        runResults: [],
        pbMs: loadPB(),
        lastSummary: ""
      });

      let state = defaultState();

      // -------------------------
      // Game-mode helper (Option A)
      // -------------------------
      function setGameMode(on) {
        // Only meaningful on mobile due to CSS media query
        document.body.classList.toggle("game-mode", !!on);
      }

      // -------------------------
      // Persistence
      // -------------------------
      function loadPB() {
        try {
          const raw = localStorage.getItem(SAVE_KEY);
          if (!raw) return null;
          const data = JSON.parse(raw);
          const pb = data && typeof data.pbMs === "number" && isFinite(data.pbMs) ? data.pbMs : null;
          return pb;
        } catch {
          return null;
        }
      }

      function savePB(pbMs) {
        try {
          localStorage.setItem(SAVE_KEY, JSON.stringify({ pbMs }));
        } catch {}
      }

      // -------------------------
      // Helpers
      // -------------------------
      function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }

      function msToText(ms) {
        if (ms == null) return "—";
        return `${ms.toFixed(DECIMALS)} ms`;
      }

      function avg(arr) {
        if (!arr.length) return null;
        const s = arr.reduce((acc, v) => acc + v, 0);
        return s / arr.length;
      }

      function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      let toastTimer = null;
      function showToast(message, ms = 1200) {
        toast.textContent = message;
        toast.classList.add("show");
        clearTimeout(toastTimer);
        toastTimer = setTimeout(() => toast.classList.remove("show"), ms);
      }

      function setPhase(phase) {
        state.phase = phase;

        app.classList.remove("phase-ready", "phase-wait", "phase-go");
        if (phase === "ready") app.classList.add("phase-ready");
        if (phase === "wait") app.classList.add("phase-wait");
        if (phase === "go") app.classList.add("phase-go");
      }

      function clearWaitTimer() {
        if (state.waitTimerId != null) {
          clearTimeout(state.waitTimerId);
          state.waitTimerId = null;
        }
      }

      function retriggerShake() {
        centerCard.classList.remove("shake");
        void centerCard.offsetWidth;
        centerCard.classList.add("shake");
      }

      // -------------------------
      // Core flow
      // -------------------------
      function startRun() {
        clearWaitTimer();
        state = defaultState();
        setPhase("wait");
        state.round = 1;
        state.runResults = [];
        state.lastMs = null;
        state.lastSummary = "";
        nextBtn.disabled = true;
        copyBtn.disabled = true;
        ctaLine.hidden = true;

        // Enter game mode for mobile while playing
        setGameMode(true);

        headline.textContent = "Wait…";
        subline.textContent = "Don’t click yet. The screen will turn red once.";
        scheduleGo();

        track("game_start", {
  total_rounds: TOTAL_ROUNDS
});

        render();
      }

      function scheduleGo() {
        clearWaitTimer();
        const delay = randomInt(WAIT_MIN_MS, WAIT_MAX_MS);
        state.waitTimerId = setTimeout(() => {
          setPhase("go");
          state.goTime = performance.now();
          headline.textContent = "CLICK!";
          subline.textContent = "Tap/click as fast as you can.";
          track("go_signal", { round: state.round, wait_ms: delay });
        }, delay);
      }

      function handleAction() {
        if (state.phase === "ready") {
          showToast("Press Start to begin.");
          return;
        }

        if (state.phase === "wait") {
          clearWaitTimer();
          retriggerShake();
          showToast("Too soon — wait for red.", 1000);
          headline.textContent = "Too soon";
          subline.textContent = "Penalty applied. Next signal will come soon.";
          track("click_early", { round: state.round });

          setTimeout(() => {
            if (state.phase !== "wait") return;
            headline.textContent = "Wait…";
            subline.textContent = "Now be ready. The screen will turn red.";
            scheduleGo();
          }, 800);

          render();
          return;
        }

        if (state.phase === "go") {
          const now = performance.now();
          const reactionMs = clamp(now - state.goTime, 0, 999999);

          state.lastMs = reactionMs;
          state.runResults.push(reactionMs);

          if (state.pbMs == null || reactionMs < state.pbMs) {
            state.pbMs = reactionMs;
            savePB(state.pbMs);
            showToast("New Personal Best!", 1200);
            track("pb_set", { pb_ms: reactionMs, round: state.round });
          } else {
            showToast("Result saved.", 900);
          }

          clearWaitTimer();
          setPhase("result");

          headline.textContent = msToText(reactionMs);
          subline.textContent = `Round ${state.round} of ${TOTAL_ROUNDS}.`;

          track("round_complete", { round: state.round, reaction_ms: reactionMs });

          if (state.round < TOTAL_ROUNDS) {
            nextBtn.disabled = false;
            copyBtn.disabled = true;
          } else {
            finishRun();
          }

          render();
          return;
        }

        if (state.phase === "result") {
          if (!nextBtn.disabled) nextRound();
          return;
        }

        if (state.phase === "done") {
          showToast("Press Start for a new run.");
          return;
        }
      }

      function nextRound() {
        if (state.phase !== "result") return;
        if (state.round >= TOTAL_ROUNDS) return;

        state.round += 1;
        state.lastMs = null;
        nextBtn.disabled = true;
        copyBtn.disabled = true;
        ctaLine.hidden = true;

        setPhase("wait");
        headline.textContent = "Wait…";
        subline.textContent = "Don’t click yet. The screen will turn red once.";
        scheduleGo();

        // keep game mode on during the run
        setGameMode(true);

        track("round_next", { round: state.round });
        render();
      }

      function finishRun() {
        clearWaitTimer();
        setPhase("done");
        nextBtn.disabled = true;

        const runAvg = avg(state.runResults);
        const runBest = Math.min(...state.runResults);
        const pb = state.pbMs;

        const summary =
          `Red Reflex — Best of 5\n` +
          `My best this run: ${runBest.toFixed(DECIMALS)} ms\n` +
          `Average: ${runAvg.toFixed(DECIMALS)} ms\n` +
          `Personal Best: ${pb.toFixed(DECIMALS)} ms`;

        state.lastSummary = summary;

        headline.textContent = "Run complete";
        subline.textContent =
          `Best: ${runBest.toFixed(DECIMALS)} ms • Avg: ${runAvg.toFixed(DECIMALS)} ms • PB: ${pb.toFixed(DECIMALS)} ms`;
        ctaLine.hidden = false;
        ctaLine.textContent = "Try to beat yourself and share to beat your friends!";

        copyBtn.disabled = false;

        // Exit game mode after run so user can scroll/read/copy comfortably
        setGameMode(false);

        track("run_complete", {
          avg_ms: runAvg,
          best_ms: runBest,
          pb_ms: pb
        });

        render();
      }

      async function copyResult() {
        if (!state.lastSummary) return;
        try {
          await navigator.clipboard.writeText(state.lastSummary);
          showToast("Copied to clipboard.", 1000);
          track("copy_result");
        } catch {
          showToast("Copy failed — your browser blocked it.", 1300);
        }
      }

      function resetPB() {
        try { localStorage.removeItem(SAVE_KEY); } catch {}
        state.pbMs = null;
        render();
        showToast("Personal Best reset.", 1000);
        track("pb_reset");
      }

      // -------------------------
      // Render
      // -------------------------
      function render() {
        roundText.textContent = `ROUND ${state.round} / ${TOTAL_ROUNDS}`;
        bestText.textContent = msToText(state.pbMs);
        lastText.textContent = msToText(state.lastMs);

        const runAvg = avg(state.runResults);
        avgText.textContent = runAvg == null ? "—" : `${runAvg.toFixed(DECIMALS)} ms`;

        startBtn.disabled = (state.phase === "wait" || state.phase === "go");
        ctaLine.hidden = (state.phase !== "done");
      }

      // -------------------------
      // Events
      // -------------------------
      startBtn.addEventListener("click", startRun);
      nextBtn.addEventListener("click", nextRound);
      copyBtn.addEventListener("click", copyResult);
      resetBtn.addEventListener("click", resetPB);

      playfield.addEventListener("click", handleAction);
      playfield.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          handleAction();
        }
      });

      // Initialize UI
      setPhase("ready");
      setGameMode(false);
      render();
    })();
  </script>
</body>
</html>
